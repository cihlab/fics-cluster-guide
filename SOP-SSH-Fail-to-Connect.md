# **SSH 连接失败排查 SOP**

## **第 1 步：初步诊断**
- **确认网络连通性**  
  ```bash
  ping <目标IP或域名>
  traceroute <目标IP或域名>   # Linux
  tracert <目标IP或域名>      # Windows
  ```
- **检查 SSH 端口是否可达**  
  ```bash
  telnet <目标IP> 22
  # 或
  nc -zv <目标IP> 22
  ```
- **验证 SSH 命令语法正确性**  
  - 用户名、主机地址、端口号是否正确？
  - 是否使用了错误的密钥文件或认证方式？
- **检查防火墙/安全组规则**  
  - 本地防火墙（如 iptables、Windows 防火墙）
  - 远程主机防火墙（如 ufw、firewalld）
  - 云平台安全组 / VPC 网络 ACL（如 AWS Security Group、阿里云安全组）

---

## **第 2 步：简化 SSH 命令**
- **移除所有高级参数**（如 `-L`、`-R`、`-D`、`-J`、`ProxyJump` 等）  
- **使用最简命令重试**：
  ```bash
  ssh <用户名>@<目标IP或域名>
  ```

---

## **第 3 步：启用详细日志模式并收集信息**
- **使用 `-vvv` 参数获取完整调试输出**：
  ```bash
  ssh -vvv <用户名>@<目标IP>
  ```
- **重点关注以下内容**：
  - 是否成功建立 TCP 连接？
  - 密钥交换（KEX）是否完成？
  - 认证阶段是否失败？原因是什么（密码/密钥/权限）？
- **保留日志文件**用于后续分析或提交管理员。
